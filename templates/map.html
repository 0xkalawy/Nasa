<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Simple Marker</title>
    <script async src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBMLA-4L8ZtfBjHB3Wp-9vB83dyL4eQmbM&libraries=places&callback=initMap" defer></script>
    <style>
        html, body {
            height: 100%;
            margin: 0;
            padding: 0;
            display: flex;
            flex-direction: column;
        }

        #start-button {
            background-color: #007BFF;
            color: #fff;
            border: none;
            padding: 15px 30px;
            font-size: 1.2rem;
            font-weight: bold;
            border-radius: 8px;
            cursor: pointer;
            transition: background-color 0.3s, transform 0.2s;
            margin: 20px auto;
        }

        #start-button:hover {
            background-color: #0056b3;
        }

        #start-button:active {
            transform: scale(0.98);
        }

        #start-button:focus {
            outline: none;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.5);
        }

        #container {
            display: none;
            flex: 1;
            flex-direction: row;
        }

        #map {
            flex: 1;
            height: 100%;
        }

        #options-div {
            flex: 1;
            padding: 20px;
            display: flex;
            flex-direction: column;
            align-items: flex-start;
        }

        label, select {
            margin: 5px 0;
        }

        @media (max-width: 768px) {
            #container {
                flex-direction: column;
            }

            #map, #options-div {
                width: 100%;
            }

            #options-div {
                padding: 10px;
            }
        }
    </style>
    <script>
        let map; // Declare map variable globally
        let marker; // Declare marker variable globally
        const apiKey = "AIzaSyBMLA-4L8ZtfBjHB3Wp-9vB83dyL4eQmbM"; // Replace with your actual API key

        document.addEventListener("DOMContentLoaded", function() {
            const startButton = document.createElement("button");
            startButton.id = "start-button";
            startButton.innerText = "Start Landsat";
            document.body.insertBefore(startButton, document.getElementById("container"));

            startButton.onclick = function () {
                document.getElementById("container").style.display = "flex"; // Show the container
                this.style.display = "none"; // Hide the start button

                if (navigator.geolocation) {
                    navigator.geolocation.getCurrentPosition(function(position) {
                        const userLocation = {
                            lat: position.coords.latitude,
                            lng: position.coords.longitude
                        };

                        // Create the map centered at the user's location
                        map = new google.maps.Map(document.getElementById('map'), {
                            zoom: 14,
                            center: userLocation
                        });

                        // Add a marker at the user's location
                        marker = new google.maps.Marker({
                            position: userLocation,
                            map: map,
                            title: 'You are here!'
                        });

                        // Add click event listener to the map
                        map.addListener('click', function(event) {
                            placeMarker(event.latLng);
                        });
                    }, function(error) {
                        handleLocationError(true);
                    });
                } else {
                    handleLocationError(false);
                }
            };

            const form = document.querySelector("#options-div form");

            form.addEventListener("submit", function(e) {
                e.preventDefault(); // Prevent form submission

                const formValue = new FormData(this);
                
                for (const [key, value] of formValue.entries()) {
                    if(key != '' && value != '') {
                        if(key == 'name') {
                            searchLocation(value);
                        }
                    }
                }
            });
        });

        function chose() {
            var langLatDiv = document.getElementById("lng-lat");
            var nameDiv = document.getElementById("name");    
            switch (document.getElementById('search-type').value) {
                case 'lng-lat':
                    langLatDiv.style.display = 'block';
                    nameDiv.style.display = 'none';
                    break;
                case 'name':
                    nameDiv.style.display = 'block';
                    langLatDiv.style.display = 'none';
                    break;
                default:
                    nameDiv.style.display = 'none';
                    langLatDiv.style.display = 'none';
            }
        }

        function searchLocation(query) {
            const service = new google.maps.places.PlacesService(map);
            service.textSearch({ query: query }, function(results, status) {
                if (status === google.maps.places.PlacesServiceStatus.OK) {
                    const place = results[0]; // Get the first result
                    const location = place.geometry.location;

                    // Update map center and place marker
                    map.setCenter(location);
                    placeMarker(location, place.name);
                } else {
                    alert('Place not found: ' + status);
                }
            });
        }

        function placeMarker(location, title = `Selected Location: ${location.lat()}, ${location.lng()}`) {
            // If a marker already exists, remove it
            if (marker) {
                marker.setMap(null);
            }

            // Create a new marker at the clicked location
            marker = new google.maps.Marker({
                position: location,
                map: map,
                title: title
            });

            // Display the selected latitude and longitude
            // alert(`Latitude: ${location.lat()}, Longitude: ${location.lng()}`);
            document.getElementById('result').innerText = 'Selected Location:\n'+location.lat()+"\n"+location.lng() ;
            document.getElementById('result').style.display = 'block' ;

        }

        function handleLocationError(browserHasGeolocation) {
            alert(browserHasGeolocation ?
                'Error: The Geolocation service failed.' :
                'Error: Your browser doesn\'t support geolocation.');
        }
    </script>
</head>
<body>
    <div id="container">
        <div id="map"></div>
        <div id="options-div">
            <form>
                <label for="search-type">Search by:</label>
                <select id="search-type" onchange="chose()">
                    <option value="name">Name</option>
                    <option value="lng-lat">Latitude & Longitude</option>
                </select>
                <div id="name">
                    <label for="place-name">Place Name:</label>
                    <input type="text" id="place-name" name="name" />
                </div>
                <div id="lng-lat" style="display: none;">
                    <label for="latitude">Latitude:</label>
                    <input type="number" id="latitude" name="latitude" step="any" />
                    <label for="longitude">Longitude:</label>
                    <input type="number" id="longitude" name="longitude" step="any" />
                </div>
                <button type="submit">Search</button>
                <p id="result" style="display: none;"></p>
            </form>
        </div>
    </div>
</body>
</html>
